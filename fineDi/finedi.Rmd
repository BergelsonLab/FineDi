---
title: "finedi"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r lib, echo=FALSE}
library(tidyverse)
```

```{r data}
data_is_child <- read_csv("/Users/gb146/FineDi-Bergelson/fineDi/static/is_child.csv")
eng <- data_is_child %>% filter(lang=='english')
tsi <- data_is_child %>% filter(lang=='tsimane')

mean(data_is_child$length)

```

## Number of times each clip was seen

Process repeated on 1800 clips, 900 in English and 900 in Tsimane. As the experiment is not over, not all clips have been scored the same number of times:


## Histogram of segment length by language

Due to Lena specs, clips are 600ms long or longer

```{r length_by_language}
ggplot(data=data_is_child, aes(data_is_child$length)) +
  geom_histogram(binwidth=0.1) + # binwidth to change
  xlim(0,8) +
  xlab("CHN segment length in seconds")+
  facet_wrap(~ lang)
```

## Percentage agreement

### Overall

```{r agreement, echo=FALSE}
data_is_child <- data_is_child %>% filter(is_child+is_not_child>0)
total_seg <- nrow(data_is_child)
agreeing_yes <- nrow(data_is_child %>% filter(is_not_child==0.0 & is_child!=0.0))
has_yes <- nrow(data_is_child %>% filter(is_child!=0.0))
is_yes <- nrow(data_is_child %>% filter(is_child>is_not_child))
agreeing_no <- nrow(data_is_child %>% filter(is_child==0.0 & is_not_child!=0.0))
has_no <- nrow(data_is_child %>% filter(is_not_child!=0.0))
is_no <- nrow(data_is_child %>% filter(is_not_child>is_child))

## All segments on which there is a concensus
overall_agreement <- (agreeing_no+agreeing_yes)/total_seg

## yes consensus / considered as yes
yes_agreement <- agreeing_yes / has_yes

## no consensus / considered as no
no_agreement <- agreeing_no / has_no

```

```{r by_language_eng, echo=FALSE}

## by language
eng <- eng %>% filter(is_child+ is_not_child >0)
eng_agreeing_yes <- nrow(eng %>% filter(is_not_child==0.0 & is_child!=0.0))
eng_has_yes <- nrow(eng %>% filter(is_child!=0.0))
eng_agreeing_no <- nrow(eng %>% filter(is_child==0.0 & is_not_child!=0.0))
eng_has_no <- nrow(eng %>% filter(is_not_child!=0.0))
eng_agreement <- (eng_agreeing_no+eng_agreeing_yes)/nrow(eng)

```

```{r by_language_tsi, echo=FALSE}
tsi <- tsi %>% filter(is_child+ is_not_child >0)
tsi_agreeing_yes <- nrow(tsi %>% filter(is_not_child==0.0 & is_child!=0.0))
tsi_has_yes <- nrow(tsi %>% filter(is_child!=0.0))
tsi_agreeing_no <- nrow(tsi %>% filter(is_child==0.0 & is_not_child!=0.0))
tsi_has_no <- nrow(tsi %>% filter(is_not_child!=0.0))
tsi_agreement <- (tsi_agreeing_no+tsi_agreeing_yes)/nrow(tsi)
```

This is computed over all segments that have been seen at least once.
The #yes-agreement is the number of times a segment was labeled as key child as least once and never as not key child (reverse for #no-agreement). #agreement is the sum of the two.
%yes-agreement is #yes-agreement divided by the number of segments labeled as key child by at least one person (reverse for %no-agreement). %agreement is #yes-agreement+#no-agreement divided by the total number of segments.


```{r agreement_res, echo=FALSE, eval=FALSE}
res <- matrix(c(overall_agreement, agreeing_no+agreeing_yes, yes_agreement, agreeing_yes, no_agreement, agreeing_no, eng_agreement, eng_agreeing_no+eng_agreeing_yes, eng_agreeing_yes/eng_has_yes, eng_agreeing_yes, eng_agreeing_no/eng_has_no, eng_agreeing_no, tsi_agreement, tsi_agreeing_no+tsi_agreeing_yes, tsi_agreeing_yes/tsi_has_yes, tsi_agreeing_yes,  tsi_agreeing_no/tsi_has_no, tsi_agreeing_no),ncol=6,byrow=TRUE)

colnames(res) <- c(" %Agreement", " #Agreement", " %Yes-agreement", " #Yes-agreement", " %No-agreement", " #No-agreement")
rownames(res) <- c("Overall", "English", "Tsimane")
res[," %Agreement"] <- res[," %Agreement"] * 100
res[," %Yes-agreement"] <- res[," %Yes-agreement"] * 100
res[," %No-agreement"] <- res[," %No-agreement"] * 100

res <- round(res)

res <- as.table(res)
res

```


```{r agreement_>1, echo=FALSE}

data_is_child <- data_is_child %>% filter(is_child+is_not_child > 1)
total_seg <- nrow(data_is_child)
agreeing_yes <- nrow(data_is_child %>% filter(is_not_child==0.0 & is_child!=0.0))
has_yes <- nrow(data_is_child %>% filter(is_child!=0.0))
is_yes <- nrow(data_is_child %>% filter(is_child>is_not_child))
agreeing_no <- nrow(data_is_child %>% filter(is_child==0.0 & is_not_child!=0.0))
has_no <- nrow(data_is_child %>% filter(is_not_child!=0.0))
is_no <- nrow(data_is_child %>% filter(is_not_child>is_child))

## All segments on which there is a concensus
overall_agreement <- (agreeing_no+agreeing_yes)/total_seg

## yes consensus / considered as yes
yes_agreement <- agreeing_yes / is_yes

## no consensus / considered as no
no_agreement <- agreeing_no / is_no

eng <- eng %>% filter(is_child+is_not_child > 1)
eng_agreeing_yes <- nrow(eng %>% filter(is_not_child==0.0 & is_child!=0.0))
eng_has_yes <- nrow(eng %>% filter(is_child!=0.0))
eng_is_yes <- nrow(eng %>% filter(is_child>is_not_child))
eng_agreeing_no <- nrow(eng %>% filter(is_child==0.0 & is_not_child!=0.0))
eng_has_no <- nrow(eng %>% filter(is_not_child!=0.0))
eng_is_no <- nrow(eng %>% filter(is_not_child>is_child))
eng_agreement <- (eng_agreeing_no+eng_agreeing_yes)/nrow(eng)

tsi <- tsi %>% filter(is_child+is_not_child > 1)
tsi_agreeing_yes <- nrow(tsi %>% filter(is_not_child==0.0 & is_child!=0.0))
tsi_has_yes <- nrow(tsi %>% filter(is_child!=0.0))
tsi_is_yes <- nrow(tsi %>% filter(is_child>is_not_child))
tsi_agreeing_no <- nrow(tsi %>% filter(is_child==0.0 & is_not_child!=0.0))
tsi_has_no <- nrow(tsi %>% filter(is_not_child!=0.0))
tsi_is_no <- nrow(tsi %>% filter(is_not_child>is_child))
tsi_agreement <- (tsi_agreeing_no+tsi_agreeing_yes)/nrow(tsi)

res <- matrix(c(overall_agreement, agreeing_no+agreeing_yes, yes_agreement, agreeing_yes, no_agreement, agreeing_no, eng_agreement, eng_agreeing_no+eng_agreeing_yes, eng_agreeing_yes/eng_is_yes, eng_agreeing_yes, eng_agreeing_no/eng_is_no, eng_agreeing_no, tsi_agreement, tsi_agreeing_no+tsi_agreeing_yes, tsi_agreeing_yes/tsi_is_yes, tsi_agreeing_yes,  tsi_agreeing_no/tsi_is_no, tsi_agreeing_no),ncol=6,byrow=TRUE)

colnames(res) <- c(" %Agreement", " #Agreement", " %Yes-agreement", " #Yes-agreement", " %No-agreement", " #No-agreement")
rownames(res) <- c("Overall", "English", "Tsimane")
res[," %Agreement"] <- res[," %Agreement"] * 100
res[," %Yes-agreement"] <- res[," %Yes-agreement"] * 100
res[," %No-agreement"] <- res[," %No-agreement"] * 100

res <- round(res)

res <- as.table(res)
res

```

## Length/agreement

```{r length_by_agreement}
agreeing_data <- data_is_child %>% 
  filter(is_child==0.0 | is_not_child==0.0)
ggplot(data=agreeing_data, aes(agreeing_data$length)) +
  geom_histogram(binwidth=0.1) + # binwidth to change
  xlab("Length of utterance (in seconds)") +
  ggtitle("CHN length in seconds for clips on which all scoring agree on 'key child'") +
  xlim(0,5) +
  facet_wrap(~ lang)

non_agreeing_data <- data_is_child %>% 
  filter(is_child!=0.0 & is_not_child!=0.0)
ggplot(data=non_agreeing_data, aes(non_agreeing_data$length)) +
  geom_histogram(binwidth=0.1) + # binwidth to change
  xlab("Length of utterance (in seconds)") +
  ggtitle("CHN length in seconds for clips on which all scoring agree on 'not key child'") +
  facet_wrap(~ lang)

```

## Length/is_child

A segment is finally labeled as key child is the number of key child labels is superior to the number of not key child labels.


```{r length_by_is_child}
yes_data <- data_is_child %>% 
  filter(is_child>is_not_child)
ggplot(data=yes_data, aes(yes_data$length)) +
  geom_histogram(binwidth=0.1) + # binwidth to change
  xlab("Length of utterance (in seconds)") +
  ggtitle("Length of CHN clips finally labeled as 'key child'") +
  facet_wrap(~ lang)

no_data <- data_is_child %>% 
  filter(is_not_child>is_child)
ggplot(data=no_data, aes(no_data$length)) +
  geom_histogram(binwidth=0.1) + # binwidth to change
  xlab("Length of utterance (in seconds)") +
  ggtitle("Length of CHN clips finally labeled as 'not key child'") +
  facet_wrap(~ lang)
```

There seem to be no difference in length distribution between the different conditions.
